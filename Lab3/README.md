# Многопоточный сериализатор и десериализатор Json

## Тестирующая система
- Машина: Macbook Air M2 (8 cores)
- Java: `Homebrew openjdk 21.0.5 aarch64`
- OS: `Mac OS X 14.6.1`
- Coroutine dispatcher: `FixedThreadPool` на 8 потоков
- Команда запуска: `java -jar JsonSerialization-1.0-SNAPSHOT.jar -- <No of test data on each test> <No of tests>`

## Сравниваемые сериализаторы

- Json multithreaded
- [Json](https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-json/kotlinx.serialization.json/-json/)
- [Cbor](https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-cbor/kotlinx.serialization.cbor/-cbor/)

## Условия теста

Каждый тест будет сериализировать и десериализровать `N` тестовых
объектов, каждый из которых состоит из рандомизированной строки (5 символов),
целого числа типа `Int` и списка из 100 строк (10 символов). Каждый запуск
будет тестировать все способы сериализации/десериализации. Каждый тест
будет повторён 100 раз и результатом будет браться среднее значение.

## Результаты

### Json multithreaded

| Количество тестовых объектов | Сериализация среднее время | Десериализация среднее время |
|------------------------------|----------------------------|------------------------------|
| 10                           | 273.21us                   | 129.383us                    |
| 100                          | 507.094us                  | 225.947us                    |
| 1000                         | 1.765961ms                 | 1.407214ms                   |
| 10000                        | 14.329508ms                | 17.520620ms                  |
| 100000                       | 136.681437ms               | 320.806483ms                 |

### Json

| Количество тестовых объектов | Сериализация среднее время | Десериализация среднее время |
|------------------------------|----------------------------|------------------------------|
| 10                           | 199.566us                  | 165.261us                    |
| 100                          | 573.415us                  | 449.03us                     |
| 1000                         | 1.933799ms                 | 2.788351ms                   |
| 10000                        | 18.236552ms                | 26.238247ms                  |
| 100000                       | 170.366200ms               | 377.084495ms                 |

### Cbor

| Количество тестовых объектов | Сериализация среднее время | Десериализация среднее время |
|------------------------------|----------------------------|------------------------------|
| 10                           | 446.767us                  | 310.186us                    |
| 100                          | 1.419497ms                 | 1.017907ms                   |
| 1000                         | 8.860455ms                 | 7.534990ms                   |
| 10000                        | 99.256659ms                | 73.505426ms                  |

### Json multithreaded vs Json

#### Сериалзиция

| Количество тестовых объектов | Multithreaded | Single thread | Дельта                                                 |
|------------------------------|---------------|---------------|--------------------------------------------------------|
| 10                           | 273.21us      | 199.566us     | <span style="color:red">+73.644us (+36.9%)</span>      |
| 100                          | 507.094us     | 573.415us     | <span style="color:green">-66.321us (-11.6%)</span>    |
| 1000                         | 1.765961ms    | 1.933799ms    | <span style="color:green">-0.167838ms (-8.7%)</span>   |
| 10000                        | 14.329508ms   | 18.236552ms   | <span style="color:green">-3.907044ms (-21.4%)</span>  |
| 100000                       | 136.681437ms  | 170.366200ms  | <span style="color:green">-33.684763ms (-20.2%)</span> |

#### Десериализцаия

| Количество тестовых объектов | Multithreaded | Single thread | Дельта                                                 |
|------------------------------|---------------|---------------|--------------------------------------------------------|
| 10                           | 129.383us     | 165.261us     | <span style="color:green">-35.878us (-21.8%)</span>    |
| 100                          | 225.947us     | 449.03us      | <span style="color:green">-223.083us (-49.7%)</span>   |
| 1000                         | 1.407214ms    | 2.788351ms    | <span style="color:green">-1.381137ms (-49.5%)</span>  |
| 10000                        | 17.520620ms   | 26.238247ms   | <span style="color:green">-8.717627ms (-33.2%)</span>  |
| 100000                       | 320.806483ms  | 377.084495ms  | <span style="color:green">-56.278012ms (-14.9%)</span> |


## Вывод

Многопоточность в среднем ускоряет работу на 15%. Чем больше количество
сериализируемых и/или десериализруемых объектов, тем больше прирост производительности.
Десериализация больше выигрывает от многопоточности, нежели сериализация. На малом количестве
сериализруемых объектов выигрыш производительности не так высок, т.к. создание потоков требует больших
больших расходов производительности. Что же касатеся другого сериализатора `Cbor`, то его производительность
намного хуже одно поточного `Json`'a. Но стоит отметить, что его десериализация в среднем быстрее
сериализации, в отличие от `Json`'a, где десериализция занимает больше времени.